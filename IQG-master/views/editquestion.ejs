<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IQG</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
      <link href="stylesheets/w3.css" rel="stylesheet">
      <script type="text/javascript" src="javascript/scripts.js"></script>
      <script type="text/javascript" src="javascript/routes.js"></script>
    
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="javascript/antixss.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    
</head>




<body style="background-color:rgb(233,231,218);"  ng-app="myApp" ng-controller="myCtrl">


<!-- Nav Bar -->
<div style="background-color:rgb(118,50,63);" class="w3-bar">
  <label style="font-family:Courier; font-size:18px; color:rgb(233,231,218);" class="w3-left w3-bar-item ">Signed in as <span id="userNameSpan"></span></label>
  <button id="logoutButton" class="w3-right w3-btn w3-bar-item"><img src='images/logout-icon.png'></button>
  <button id="myQuestButton" style="font-family:Courier; font-size:18px; color:rgb(233,231,218); text-align:center;" class="w3-right w3-btn w3-bar-item"><b>My Questions</b></button>   
</div> 
<!-- End Nav Bar -->

<script>
    $('#userNameSpan').html('<%= name %>');
</script>






<div class="w3-container"> 

<br>
 <header style="color:rgb(86,86,86);" class="w3-margin-top w3-container w3-xxlarge">Review your Questions</header>
<br>
<br>

<br>
<br>
<br>

<button onclick="goBack()" id="backButton" style="background-color:rgb(118,50,63); color:rgb(205,216,199); text-align:center;" class=" w3-btn w3-round ">&#8592; Back</button>

<br>
<br>



<form  ng-hide="Edithideform">
<br>
<br>
  <h3 style="color:rgb(86,86,86);" ng-hide="edit"><b><i>Edit your Questions</i></b></h3>
  
 <br> 
   
  <input id=editid  class="w3-input w3-border" type="text" ng-model="editid"   ng-hide="EditID">
 
  <input id=editrevid  class="w3-input w3-border" type="text" ng-model="editrevid"   ng-hide="EditrevID">
 
  
  <input id=editadderid  class="w3-input w3-border" type="text" ng-model="editadderid"   ng-hide="EditadderID">
 
  
    <label>Question:</label>
    <textarea id=editname  class="w3-input w3-border" type="text" ng-model="editname" style="width:50%" placeholder="Question description"></textarea>
 <br>
 
 <label>Options:</label>
 <br>
 <br>
 
 <div class="input-group" style="width:50%" ng-hide="editoption1">
  <input id =editop1 ng-model="editop1" type="text" class="form-control" placeholder="Option1">
  <span class="input-group-btn"><button class="btn btn-secondary w3-green w3-ripple" type="button" ng-disabled="editbuttonOne"  >&#10004;</button> </span>
  <span class="input-group-btn"><button style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="btn btn-secondary" type="button" ng-click="hideoption1()">x</button> </span>
  </div>
  
  <br>
  
  <div class="input-group" style="width:50%" ng-hide="editoption2">
  <input id =editop2 ng-model="editop2" type="text" class="form-control" placeholder="Option2">
  <span class="input-group-btn"><button class="btn btn-secondary w3-green w3-ripple" type="button" ng-disabled="editbuttonTwo" >&#10004;</button> </span>
  <span class="input-group-btn"><button style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="btn btn-secondary" type="button" ng-click="hideoption2()">x</button> </span>
  </div>
  
   <br>
   
   <div class="input-group" style="width:50%" ng-hide="editoption3">
  <input id =editop3  ng-model="editop3" type="text" class="form-control" placeholder="Option3">
  <span class="input-group-btn"><button class="btn btn-secondary w3-green w3-ripple" type="button" ng-disabled="editbuttonThree"  >&#10004;</button> </span>
  <span class="input-group-btn"><button style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="btn btn-secondary" type="button" ng-click="hideoption3()">x</button> </span>
  </div>
  
   <br>
   
   <div class="input-group" style="width:50%" ng-hide="editoption4">
  <input id =editop4  ng-model="editop4" type="text" class="form-control" placeholder="Option4">
 <span class="input-group-btn"><button class="btn btn-secondary w3-green w3-ripple" type="button" ng-disabled="editbuttonFour"   >&#10004;</button> </span>
  <span class="input-group-btn"><button style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="btn btn-secondary" type="button" ng-click="hideoption4()">x</button> </span>
  </div>
  
   <br>
  
  <button  style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="w3-btn w3-round w3-ripple" ng-hide="Addoption" ng-click="Addoptionbutton()"  >Add  option </button>
  
 <br>
 <br>
 
  <label>Model Answer:</label>
  <br>
   	<select id=editmodelanswer ng-model="editmodelanswer" class="w3-select w3-border w3-round " style="width:50%" name="option">
			    <option value="" disabled selected>Choose a model answer..</option>
			     <option ng-repeat="x in optionmodelanswer" value={{x}}>{{x}}</option>
    </select>
  
<br> 
 <br>
 <br>
   <label>Category:</label>
   <br>
  	<select id=editcategory  ng-model="editcategory" ng-change="changesubcategory()"  class="w3-select w3-border w3-round " style="width:50%" name="option">
			    <option value="" disabled selected>Choose Category..</option>
			    <option ng-repeat="x in findcategory" value={{x.name}}>{{x.name}}</option>
			  </select>
  
<br> 
<br>
<br>
 
 
   <label>SubCategory:</label>
  	 <br>
  	  <select id=editsubcategory  ng-model="editsubcategory"  class="w3-select w3-border w3-round " style="width:50%" name="option">
					    <option value="" disabled selected>Choose a subcategory..</option>
					    <option ng-repeat="x in findsubcategory" value={{x.name}}>{{x.name}}</option>
	   </select>
  
  
<br> 
 <br>
 <label>Question Level:</label>
  	<br>
  	    <select id =editqlevel ng-model="editqlevel" class="w3-select w3-border w3-round " style="width:50%" name="option">
			    <option value="" disabled selected>Choose Difficulty..</option>
			    <option value="Easy">Beginner</option>
			    <option value="Medium">Intermediate</option>
			    <option value="Hard">Advanced</option>
	   </select>
    
            
 <br> 
 <br>
 
  <label>Estimate Time in Minutes:</label>
  <br>
    <input id =editestime class="w3-input w3-border" type="number" ng-model="editestime" style="width:50%" placeholder="Estimate Time">
  <br>
 <br>
 
 <label>Comment:</label>
   <textarea id =editcomment class="w3-input w3-border" type="text" ng-model="editcomment" style="width:50%" placeholder="Comment"></textarea>
  
 <br>
 
 
<button  style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="w3-btn w3-round w3-ripple"  onclick="updateQuestion()" ng-disabled="incomplete">&#10004; Save Changes </button>  <button style="background-color:rgb(118,50,63); color:rgb(205,216,199);" class="w3-btn w3-round" onclick="returnHomepage()" > Cancel</button>
<br>
<br>



</form>



<br>
<br>

 
</div>







<script>









function updateQuestion()

{
	var id=$('#editid').val();
	var rev=$('#editrevid').val();
	var name = $('#editname').val();
	var op1= $('#editop1').val();
	var op2= $('#editop2').val();
	var op3= $('#editop3').val();
	var op4= $('#editop4').val();
	var modelanswer=$('#editmodelanswer').val();
	var category=$('#editcategory').val();
	var subcategory=$('#editsubcategory').val();
	var qlevel=$('#editqlevel').val();
	var estime=Number($('#editestime').val());
	var adderid=$('#editadderid').val();
	var reviewerid='<%= email %>';
	var status="pending";
	var comment=$('#editcomment').val();
	var repetition=0;
	var type="question";
	var adderemail=$('#editadderid').val();
	var revieweremail='<%= email %>';
	var currentTime = new Date();
	var month = currentTime.getMonth() + 1;
	var day = currentTime.getDate();
	var year = currentTime.getFullYear();
	var date= day+"/"+month+"/"+year;
	
	
	 $.ajax({
		  method: "POST",
		  url: "./api/updateQuestion",
		  contentType: "application/json",
		  data: JSON.stringify({"id":id,"rev":rev,"name" : name,"op1": op1,"op2":op2,"op3":op3,"op4":op4,"modelanswer":modelanswer,"category":category,"subcategory":subcategory,"qlevel":qlevel,"estime":estime,"adderid":adderid,"reviewerid":reviewerid,"status":status,"comment":comment,"rep":repetition,"type":type,"adderemail":adderemail,"revieweremail":revieweremail,"date":date})
       })	 
       .done(function(data) {
    	   alert("Question is updated successfully");
    	   returnHomepage();
        });
		
}




function goBack()
{
	window.history.back();
}




var app = angular.module('myApp', []);

app.controller('myCtrl', function($scope, $http) {
	
	$scope.name= '';
	$scope.op1 = '';
	$scope.op2 = '';
	$scope.op3 = '';
	$scope.op4 = '';
	$scope.modelanswer = '';
	$scope.category = '';
	$scope.subcategory = '';
	$scope.qlevel = '';
	$scope.estime = '';
	$scope.comment = '';
	$scope.userEmail = '<%= email %>';
    $scope.userID= '<%= id %>';
	$http({ url: "/api/findquestions",  method: "GET", params: {"userEmail": $scope.userEmail}}).then(function (response) { $scope.find = response.data;  $scope.editUser(); });
	
  	$scope.edit = false;
	$scope.error = false;
	$scope.Edithideform = true;	
	
	$scope.Addoption=true;
	                     
	$scope.EditrevID=true;
	$scope.EditID = true;	
	$scope.EditadderID = true;
	
	$http.get("/api/findcategory").then(function (response) { $scope.findcategory = response.data;});
	 $scope.changesubcategory = function()
	  {
			 $http({ url: "/api/findsubcategory",  method: "GET", params: {"categoryname": $scope.editcategory}}).then(function (response) { $scope.findsubcategory = response.data; });
			 $scope.subcategorycontainer=false;
	  }
	
	
	$scope.editUser = function() 
	{
		
		$scope.editname= '';
		$scope.editop1 = '';
		$scope.editop2 = '';
		$scope.editop3 = '';
		$scope.editop4 = '';
		$scope.editmodelanswer = '';
		$scope.editcategory = '';
		$scope.editsubcategory = '';
		$scope.editqlevel = '';
		$scope.editestime = '';
		$scope.editcomment = '';
		
	    $scope.Edithideform = false;
	   
	    for(var i=0;i<$scope.find.length;i++)
	    {
	    	
	    	if($scope.find[i]._id == $scope.userID)
	    		{
		    		$scope.editname = $scope.find[i].name;
		    	    $scope.editop1 = $scope.find[i].op1;
		    	    $scope.editop2 = $scope.find[i].op2;
		    	    $scope.editop3 = $scope.find[i].op3;
		    	    $scope.editop4 = $scope.find[i].op4;
		    	    $scope.editid=$scope.find[i]._id;
		    	    $scope.editrevid=$scope.find[i]._rev;
		    	    $scope.editadderid=$scope.find[i].adderid;
		    	    $scope.editmodelanswer=$scope.find[i].modelanswer;
		    	    $scope.editcategory=$scope.find[i].category;
		    	    $scope.editsubcategory=$scope.find[i].subcategory;
		    	    $scope.editqlevel=$scope.find[i].qlevel;
		    	    $scope.editestime=$scope.find[i].estime;
		    	    $scope.editcomment=$scope.find[i].comment;
		    	    
	    		}
	    }	
	    
	    
	    $http({ url: "/api/findsubcategory",  method: "GET", params: {"categoryname": $scope.editcategory}}).then(function (response) { $scope.findsubcategory = response.data;});
		
	    // for option list 
	    	if ($scope.editop3 !="" && $scope.editop4 =="")
	    	{
	    	 	$scope.optionmodelanswer=[$scope.editop1,$scope.editop2,$scope.editop3,]
	    	 	$scope.editoption4=true;
	    	 	$scope.editoption3=false;
	    	 	$scope.editoption1=false;
	    	 	$scope.editoption2=false;
	    	 	$scope.Addoption=false;
	    	 	
	    	}
	    	
	    
	    
	    	else if ($scope.editop4 !="")
	    	{
		    	$scope.optionmodelanswer=[$scope.editop1,$scope.editop2,$scope.editop3,$scope.editop4,]
		    	$scope.editoption4=false;
	    	 	$scope.editoption3=false;
	    	 	$scope.editoption1=false;
	    	 	$scope.editoption2=false;
	    	 	$scope.Addoption=true;
	    	 	
	    	}
	    
	    
	    	else if($scope.editop1 !="" && $scope.editop2 !="" && $scope.editop3=="" && $scope.editop4 =="" )
	    	{
	    		$scope.optionmodelanswer=[$scope.editop1,$scope.editop2,]
	    		$scope.editoption4=true;
	    	 	$scope.editoption3=true;
	    	 	$scope.editoption1=false;
	    	 	$scope.editoption2=false;
	    	 	$scope.Addoption=false;
	    	}
	    
	    
	};


	 $scope.hideoption1 = function() 
	 {
		 
		 if ($scope.editoption2)
			 {
			 	$scope.editop1='';
			 	$scope.editoption1=true;
			 	$scope.Addoption=false;
			 }
		 
		 else if(!$scope.editoption2 && $scope.editoption3 && $scope.editoption4)
			 {
			 	$scope.editop1=$scope.editop2;
			 	$scope.editop2='';
			 	$scope.editoption2=true;
			 	$scope.Addoption=false;
			 }
		 else if (!$scope.editoption2 && !$scope.editoption3 && $scope.editoption4)
			 {
			 	$scope.editop1=$scope.editop2;
			 	$scope.editop2=$scope.editop3;
			 	$scope.editop3='';
			 	$scope.editoption3=true;
			 	$scope.Addoption=false;
			 	
			 }
		 else if (!$scope.editoption2 && !$scope.editoption3 && !$scope.editoption4)
			 {
			 	$scope.editop1=$scope.editop2;
			 	$scope.editop2=$scope.editop3;
			 	$scope.editop3=$scope.editop4;
			 	$scope.editop4='';
			 	$scope.editoption4=true;
			 	$scope.Addoption=false;
			 }
		 
		 
	 };
	
	
	 $scope.hideoption2 = function() 
	 {
		
		if(!$scope.editoption1 && $scope.editoption3 && $scope.editoption4)
			{
				$scope.editop2='';
				$scope.editoption2=true;
				$scope.Addoption=false;
			}
		
		else if (!$scope.editoption1 && !$scope.editoption3 && $scope.editoption4)
			{
				$scope.editop2=$scope.editop3;
				$scope.editop3='';
				$scope.editoption3=true;
				$scope.Addoption=false;
			}
		
		else if (!$scope.editoption1 && !$scope.editoption3 && !$scope.editoption4)
			{
				$scope.editop2=$scope.editop3;
				$scope.editop3=$scope.editop4;
				$scope.editop4='';
				$scope.editoption4=true;
				$scope.Addoption=false;
			}
		
	 };
	 
	 $scope.hideoption3 = function() 
	 {
		
		 if(!$scope.editoption1 && !$scope.editoption2 && $scope.editoption4)
			 {
			   $scope.editop3='';
			   $scope.editoption3=true;
			   $scope.Addoption=false;
			  
			 }
		 
		 else if(!$scope.editoption1 && !$scope.editoption2 && !$scope.editoption4)
			 {
			 	$scope.editop3=$scope.editop4;
			 	$scope.editop4='';
			 	$scope.editoption4=true;
			 	$scope.Addoption=false;
			 }
		 
		 
	 };
	 
	 $scope.hideoption4 = function() 
	 {
		 $scope.editop4='';
		 $scope.editoption4=true;
		 $scope.Addoption=false;
	 };
	 
	 
	 $scope.Addoptionbutton=function()
	 {
		 if($scope.editoption1)
			 $scope.editoption1=false;
		 else if(!$scope.editoption1 && $scope.editoption2)
			 $scope.editoption2=false;
		 else if (!$scope.editoption1  && !$scope.editoption2  && $scope.editoption3  )
			 $scope.editoption3=false;
		 else if (!$scope.editoption1  && !$scope.editoption2  && !$scope.editoption3   && $scope.editoption4 )
			 {
				 $scope.editoption4=false;
				 $scope.Addoption=true;
			 }
		 
	 };
	 
	 
	 
	 
	$scope.$watch('editname', function() {$scope.test();});
	$scope.$watch('editop1', function() {$scope.watchoption();});
	$scope.$watch('editop2', function() {$scope.watchoption();});
	$scope.$watch('editop3', function() {$scope.watchoption();});
	$scope.$watch('editop4', function() {$scope.watchoption();});
	$scope.$watch('editmodelanswer', function() {$scope.test();});
	$scope.$watch('editcategory', function() {$scope.test();});
	$scope.$watch('editsubcategory', function() {$scope.test();});
	$scope.$watch('editqlevel', function() {$scope.test();});
	$scope.$watch('editestime', function() {$scope.test();});
	
	
	
	
	
	
	
	$scope.watchoption=function()
	{
		$scope.incomplete=false;
		
		if ( $scope.editop1.length && !$scope.editop2.length &&  !$scope.editop3.length && !$scope.editop4.length)
			$scope.optionmodelanswer=[$scope.editop1,]
		else if ( $scope.editop1.length && $scope.editop2.length &&  $scope.editop3.length && !$scope.editop4.length)
	    	 $scope.optionmodelanswer=[$scope.editop1,$scope.editop2,$scope.editop3,]
		
	    else if($scope.editop1.length && $scope.editop2.length && !$scope.editop3.length && !$scope.editop4.length)
	    		$scope.optionmodelanswer=[$scope.editop1,$scope.editop2,]
	    
	    else if ($scope.editop1.length && $scope.editop2.length && $scope.editop3.length && $scope.editop4.length)
	    	  $scope.optionmodelanswer=[$scope.editop1,$scope.editop2,$scope.editop3,$scope.editop4,]
		
	    else 
	    	$scope.optionmodelanswer=[]
		
		if( !$scope.editop1.length ||  !$scope.editop2.length )
			{$scope.incomplete = true;}
		
		if(!$scope.editop1.length )
			$scope.editbuttonOne=true;
		else
			$scope.editbuttonOne=false;
			
		if(!$scope.editop2.length )
			$scope.editbuttonTwo=true;
		else
			$scope.editbuttonTwo=false;
		
		if(!$scope.editop3.length )
			$scope.editbuttonThree=true;
		else
			$scope.editbuttonThree=false;
		
		if(!$scope.editop4.length )
			$scope.editbuttonFour=true;
		else
			$scope.editbuttonFour=false;
		
	};
	
	
	
	
	$scope.test = function() {
	 
	  $scope.incomplete = false;
	  
	
	  if ( !$scope.editname.length ||!$scope.editop1.length ||  !$scope.editop2.length|| $scope.editmodelanswer==null || !$scope.editcategory.length || !$scope.editsubcategory.length ||!$scope.editqlevel.length || isNaN($scope.editestime) )
	  {$scope.incomplete = true;}
	  
	  
	};
	
   
	
	
	
});



</script>

</body>
</html>



